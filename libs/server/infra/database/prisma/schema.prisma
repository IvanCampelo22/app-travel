generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                 Int               @id @default(autoincrement())
  name               String            @db.VarChar(64)
  dobName            String?           @db.VarChar(64)
  taxId              String?           @db.VarChar(30)
  brand              String?           @db.VarChar(256)
  contactPrefix      String?           @db.VarChar(6)
  contactFirstName   String?           @db.VarChar(32)
  contactMiddleName  String?           @db.VarChar(32)
  contactLastName    String?           @db.VarChar(32)
  contactSuffix      String?           @db.VarChar(6)
  jobTitle           String?           @db.VarChar(32)
  /// @zod.string.email()
  email              String            @db.VarChar(64)
  phone              String?           @db.VarChar(32)
  mobilePhone        String?           @db.VarChar(64)
  fax                String?           @db.VarChar(64)
  billingAdresses    Json?
  shippingAdresses   Json?
  termsAndConditions String?
  privacyPolicy      String?
  bankName           String?           @db.VarChar(64)
  branch             String?
  bankAccount        String?           @db.VarChar(64)
  notes              String?
  countryCode        String?           @db.VarChar(2)
  currencyCode       String?           @db.VarChar(3)
  locale             String?           @db.VarChar(6)
  timeZone           String?           @db.VarChar(20)
  referralSource     String?
  domain             String?           @db.VarChar(64)
  siteConfig         String?
  createdAt          DateTime?         @default(now())
  createdBy          String?           @db.VarChar(32)
  modifiedAt         DateTime          @updatedAt
  modifiedBy         String?           @db.VarChar(32)
  isActive           Boolean?          @default(true)
  isMaster           Boolean?          @default(false)
  users              User[]            @relation("users")
  accounts           Account[]         @relation("accounts")
  bookings           Booking[]         @relation("bookings")
  bookingTravelers   BookingTraveler[] @relation("bookingTravelers")
  bookingProducts    BookingProduct[]  @relation("bookingProducts")

  @@unique([email])
}

model User {
  /// @zod.custom.omit([model, input])
  id          Int       @id @default(autoincrement())
  tenantId    Int?
  tenant      Tenant?   @relation(fields: [tenantId], references: [id], name: "users")
  accountId   Int?
  account     Account?  @relation(fields: [accountId], references: [id], name: "accountUsers")
  externalId  String
  firstName   String    @db.VarChar(32)
  lastName    String    @db.VarChar(32)
  companyName String?   @db.VarChar(32)
  jobTitle    String?   @db.VarChar(32)
  department  String?   @db.VarChar(32)
  managerName String?   @db.VarChar(32)
  /// @zod.string.email()
  email       String    @db.VarChar(64)
  phone       String?   @db.VarChar(32)
  mobilePhone String?   @db.VarChar(32)
  fax         String?   @db.VarChar(64)
  adresses    Json?
  gender      String?
  birthDate   DateTime? @db.Date
  createdAt   DateTime? @default(now())
  createdBy   String?   @db.VarChar(32)
  modifiedAt  DateTime? @updatedAt
  modifiedBy  String?   @db.VarChar(32)
  isActive    Boolean?  @default(true)
  isMaster    Boolean?  @default(false)

  @@unique([email])
}

enum AccountCategory {
  Agency
  InternalAgent
  Customer
  Supplier
  Influencer
}

model Account {
  /// @zod.custom.omit([model, input])
  id                 Int               @id @default(autoincrement())
  tenantId           Int
  tenant             Tenant            @relation(fields: [tenantId], references: [id], name: "accounts")
  parentId           Int?
  parent             Account?          @relation(fields: [parentId], references: [id], name: "childAccounts")
  ownerId            Int
  childAccounts      Account[]         @relation("childAccounts")
  accountUsers       User[]            @relation("accountUsers")
  name               String            @db.VarChar(64)
  category           AccountCategory
  dobName            String?           @db.VarChar(64)
  taxId              String?           @db.VarChar(24)
  ssn                String?           @db.VarChar(24)
  brand              String?           @db.VarChar(64)
  /// @zod.string.email()
  email              String            @db.VarChar(64)
  phone              String?           @db.VarChar(32)
  mobilePhone        String?           @db.VarChar(32)
  fax                String?           @db.VarChar(64)
  billingAdresses    Json?
  shippingAdresses   Json?
  termsAndConditions String?
  privacyPolicy      String?
  bankName           String?           @db.VarChar(64)
  branch             String?
  bankAccount        String?           @db.VarChar(64)
  notes              String?
  countryCode        String?           @db.VarChar(2)
  currencyCode       String?           @db.VarChar(3)
  locale             String?           @db.VarChar(6)
  timeZone           String?           @db.VarChar(20)
  referralSource     String?
  domain             String?           @db.VarChar(64)
  siteConfig         String?
  createdAt          DateTime?         @default(now())
  createdBy          String?           @db.VarChar(32)
  modifiedAt         DateTime          @updatedAt
  modifiedBy         String?           @db.VarChar(32)
  isActive           Boolean?          @default(true)
  bookings           Booking[]         @relation("bookings")
  purchasing         Booking[]         @relation("purchasing")
  bookingTravelers   BookingTraveler[] @relation("bookingTravelers")
  bookingProducts    BookingProduct[]  @relation("bookingProducts")

  @@unique([name])
}

enum BookingStatus {
  WaitingService
  WaitingCustomer
  WaitingPayment
  Paid
  QuoteSend
  Canceled
  RefundRequested
  Refunded
  Draft
}

model Booking {
  /// @zod.custom.omit([model, input])
  id                 Int               @id @default(autoincrement())
  tenantId           Int
  tenant             Tenant            @relation(fields: [tenantId], references: [id], name: "bookings")
  accountId          Int
  account            Account           @relation(fields: [accountId], references: [id], name: "bookings")
  customerId         Int?
  customer           Account?          @relation(fields: [customerId], references: [id], name: "purchasing")
  ownerId            Int?
  customerName       String?           @db.VarChar(128)
  /// @zod.string.email()
  customerEmail      String?           @db.VarChar(64)
  customerPhone      String?           @db.VarChar(32)
  postalCode         String?           @db.VarChar(32)
  fromCity           String?           @db.VarChar(64)
  toCity             String?           @db.VarChar(64)
  travelDate         DateTime?
  travelPeriod       String?           @db.VarChar(12)
  adultsCount        Int?
  childrenCount      Int?
  seniorsCount       Int?
  requestDescription String?
  status             BookingStatus?    @default(WaitingService)
  locatorCode        String?           @db.VarChar(14)
  totalPrice         Decimal?          @db.Money
  totalCost          Decimal?          @db.Money
  paymentType        String?           @db.VarChar(10)
  paymentStatus      String?           @db.VarChar(10)
  paymentDateTime    DateTime?
  discountPercent    Decimal?          @db.Decimal(3, 1)
  discountAmount     Decimal?          @db.Money
  paymentAmount      Decimal?          @db.Money
  voucherFilePath    String?
  receiptFilePath    String?
  invoiceFilePath    String?
  createdAt          DateTime?         @default(now())
  createdBy          String?           @db.VarChar(32)
  modifiedAt         DateTime?         @updatedAt
  modifiedBy         String?           @db.VarChar(32)
  isActive           Boolean?          @default(true)
  travelers          BookingTraveler[] @relation("travelers")
  products           BookingProduct[]  @relation("products")
}

model BookingTraveler {
  /// @zod.custom.omit([model, input])
  id                 Int       @id @default(autoincrement())
  tenantId           Int
  tenant             Tenant    @relation(fields: [tenantId], references: [id], name: "bookingTravelers")
  bookingId          Int
  booking            Booking   @relation(fields: [bookingId], references: [id], name: "travelers")
  accountId          Int
  account            Account   @relation(fields: [accountId], references: [id], name: "bookingTravelers")
  ownerId            Int
  firstName          String    @db.VarChar(32)
  lastName           String    @db.VarChar(32)
  birthDate          DateTime  @db.Date
  passportNumber     String    @db.VarChar(64)
  passportIssueDate  DateTime  @db.Date
  passportExpireDate DateTime  @db.Date
  /// @zod.string.email()
  email              String    @db.VarChar(64)
  phone              String?   @db.VarChar(32)
  createdAt          DateTime? @default(now())
  createdBy          String?   @db.VarChar(32)
  modifiedAt         DateTime  @updatedAt
  modifiedBy         String?   @db.VarChar(32)
  isActive           Boolean?  @default(true)
}

enum ProductCategory {
  Accommodation
}

enum AccommodationType {
  Hotel
  Resort
}

model BookingProduct {
  /// @zod.custom.omit([model, input])
  id                          Int                @id @default(autoincrement())
  tenantId                    Int
  tenant                      Tenant?            @relation(fields: [tenantId], references: [id], name: "bookingProducts")
  bookingId                   Int
  booking                     Booking?           @relation(fields: [bookingId], references: [id], name: "products")
  accountId                   Int
  account                     Account?           @relation(fields: [accountId], references: [id], name: "bookingProducts")
  supplierId                  Int?
  supplierName                String?            @db.VarChar(128)
  ownerId                     Int
  category                    ProductCategory
  description                 String?
  startDate                   DateTime           @db.Date
  endDate                     DateTime           @db.Date
  fromLocation                String?            @db.VarChar(64)
  toLocation                  String             @db.VarChar(64)
  termsAndConditions          String?
  locatorCode                 String?            @db.VarChar(14)
  productCost                 Decimal?           @db.Money
  tenantMarkup                Decimal?           @db.Money
  agencyMarkup                Decimal?           @db.Money
  agentMarkup                 Decimal?           @db.Money
  localTaxes                  Decimal?           @db.Money
  stateTaxes                  Decimal?           @db.Money
  federalTaxes                Decimal?           @db.Money
  additionalFees              Decimal?           @db.Money
  discountPercent             Decimal?           @db.Decimal(3, 1)
  discount                    Decimal?           @db.Money
  finalPrice                  Decimal?           @db.Money
  paymentDueDate              DateTime?          @db.Date
  paidDate                    DateTime?          @db.Date
  paymentAmount               Decimal?           @db.Money
  voucherFilePath             String?
  receiptFilePath             String?
  invoiceFilePath             String?
  status                      String?            @db.VarChar(10)
  hotelName                   String?            @db.VarChar(128)
  hotelStarRating             Int?
  hotelMealPlan               String?            @db.VarChar(64)
  accommodationType           AccommodationType?
  roomCategory                RoomCategory?
  adultsCount                 Int
  minorsCount                 Int
  ageOfMinors                 Int[]
  bookingGroupId              Int?
  paymentType                 String?            @db.VarChar(64)
  paymentDescription          String?
  creditCardType              String?            @db.VarChar(32)
  creditCardLastFourDigits    Int?
  creditCardAuthorizationCode String?
  createdAt                   DateTime?          @default(now())
  createdBy                   String?            @db.VarChar(32)
  modifiedAt                  DateTime           @updatedAt
  modifiedBy                  String?            @db.VarChar(32)
  isActive                    Boolean?           @default(true)
}

enum RoomCategory {
  SuiteMaster
  SuitePremium
  SuiteJunior
}
